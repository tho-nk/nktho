<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Portable Game Notation Parsing with C++'><title>PGN Parser</title>
<link rel=canonical href=https://www.nktho.fr/p/programmation/><link rel=stylesheet href=/scss/style.min.ff300df33b80e2ac49809c825614392ed1c7b27591d65d3c4043602cd162e25f.css><meta property='og:title' content='PGN Parser'><meta property='og:description' content='Portable Game Notation Parsing with C++'><meta property='og:url' content='https://www.nktho.fr/p/programmation/'><meta property='og:site_name' content='OH! THO'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-06-22T00:00:00+00:00'><meta property='article:modified_time' content='2024-06-22T00:00:00+00:00'><meta property='og:image' content='https://www.nktho.fr/p/programmation/eifel.jpeg'><meta name=twitter:title content="PGN Parser"><meta name=twitter:description content="Portable Game Notation Parsing with C++"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://www.nktho.fr/p/programmation/eifel.jpeg'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_huf417df7fc3a6099e03aa0ad0698cb11b_1014409_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>OH! THO</a></h1><h2 class=site-description>Learn, learn more, learn forever!</h2></div></header><ol class=social-menu><li><a href=https://www.facebook.com/tho.nguyenkhac/ target=_blank title=Facebook rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-facebook" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1-4h-4V8a1 1 0 011-1h3V3h-3a5 5 0 00-5 5v2H7"/></svg></a></li><li><a href=https://github.com/tho-nk/ target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/tho-nguyen-khac/ target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://twitter.com/ugitho target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://www.nktho.fr/ selected>English</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span></span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title"></h2><div class=widget--toc><nav id=TableOfContents><ol><li><ol><li><a href=#1-overview>1. Overview</a><ol><li><a href=#input>Input</a></li><li><a href=#output>Output</a></li></ol></li><li><a href=#2-architecture>2. Architecture</a><ol><li><a href=#basepiece-class>BasePiece Class</a></li><li><a href=#derived-piece-classes>Derived Piece Classes</a></li><li><a href=#piece-variants>Piece Variants</a></li><li><a href=#square-class>Square Class</a></li></ol></li><li><a href=#3-pros-and-cons>3. Pros and Cons</a><ol><li><a href=#pros>Pros:</a></li><li><a href=#cons>Cons:</a></li></ol></li><li><a href=#4-improvement>4. Improvement</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/programmation/><img src=/p/programmation/eifel_hu5cc6d93db45cbbd6ae4d62acca4e5f7e_165761_800x0_resize_q75_box.jpeg srcset="/p/programmation/eifel_hu5cc6d93db45cbbd6ae4d62acca4e5f7e_165761_800x0_resize_q75_box.jpeg 800w, /p/programmation/eifel_hu5cc6d93db45cbbd6ae4d62acca4e5f7e_165761_1600x0_resize_q75_box.jpeg 1600w" width=800 height=453 loading=lazy alt="Featured image of post PGN Parser"></a></div><div class=article-details><header class=article-category><a href=/categories/programmation/>Programmation</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/programmation/>PGN Parser</a></h2><h3 class=article-subtitle>Portable Game Notation Parsing with C++</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 22, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading></time></div></footer></div></header><section class=article-content><p>Table of Contents</p><ol><li><a class=link href=#1-overview>Overview</a></li><li><a class=link href=#2-architecture>Architecture</a></li><li><a class=link href=#3-pros_cons>Pros and Cons</a></li><li><a class=link href=#4-improvement>Improvement</a></li></ol><h3 id=1-overview>1. Overview</h3><p>This parser supports the PGN format based on <a class=link href=https://en.wikipedia.org/wiki/Portable_Game_Notation target=_blank rel=noopener>Portable Game Notation</a>. The movetext is based on SAN (Standard Algebraic Notation). Disambiguation is supported by checking if the king is being checked before accepting a move.</p><p>It requires:</p><ul><li>CMake 3.22</li><li>GCC 12.1 and C++20 standard</li><li>Ubuntu 23.10 or the Docker image iainttho/ubuntu:23.10.02 based on Ubuntu 23.10.</li></ul><p>The state of the board at the end of the game, in the form of an 8x8 grid:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>bR|bN|bB|bQ|bK|bB|bN|bR
</span></span><span class=line><span class=cl>bP|bP|bP|bP|bP|bP|bP|bP
</span></span><span class=line><span class=cl>  |  |  |  |  |  |  |  
</span></span><span class=line><span class=cl>  |  |  |  |  |  |  |  
</span></span><span class=line><span class=cl>  |  |  |  |  |  |  |  
</span></span><span class=line><span class=cl>  |  |  |  |  |  |  |  
</span></span><span class=line><span class=cl>wP|wP|wP|wP|wP|wP|wP|wP
</span></span><span class=line><span class=cl>wR|wN|wB|wQ|wK|wB|wN|wR
</span></span></code></pre></td></tr></table></div></div><h4 id=input>Input</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>1. e4 e6 2. e5 f6 3. exf6 gxf6 4. Ke2 h6 5. Ke3 h5 6. Ke4 e5 7. Nh3 d6 8. Ng5 Be6 9. Nf3 Bh3 10. Nc3 Bxg2 11. Na4 b6 12. Nc5 b5 13. Nd3 b4 14. Nxe5 b3 1/2-1/2
</span></span></code></pre></td></tr></table></div></div><h4 id=output>Output</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-plaintext data-lang=plaintext><span class=line><span class=cl>bR|bN|  |bQ|bK|bB|bN|bR
</span></span><span class=line><span class=cl>bP|  |bP|  |  |  |  |  
</span></span><span class=line><span class=cl>  |  |  |bP|  |bP|  |  
</span></span><span class=line><span class=cl>  |  |  |  |wN|  |  |bP
</span></span><span class=line><span class=cl>  |  |  |  |wK|  |  |  
</span></span><span class=line><span class=cl>  |bP|  |  |  |wN|  |  
</span></span><span class=line><span class=cl>wP|wP|wP|wP|  |wP|bB|wP
</span></span><span class=line><span class=cl>wR|  |wB|wQ|  |wB|  |wR
</span></span></code></pre></td></tr></table></div></div><h3 id=2-architecture>2. Architecture</h3><p>In this project, I&rsquo;ve implemented a new approach using <code>std::variant</code> to represent the pieces within the square. This leverages the <code>CRTP</code> (Curiously Recurring Template Pattern) to achieve a flexible and efficient solution. Polymorphism is implemented using <code>std::visit</code>, providing runtime polymorphism without relying on virtual functions and vtables.</p><h4 id=basepiece-class>BasePiece Class</h4><p>The piece type is represented using the <code>BasePiece</code> template class, leveraging <code>CRTP</code> for flexible and efficient code structuring.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>typename</span> <span class=n>ConcretePiece</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>BasePiece</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Provides access to the derived class, potential improvement with `this ConcretePiece&amp;&amp; self`
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>ConcretePiece</span> <span class=o>&amp;</span><span class=n>self</span><span class=p>()</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>ConcretePiece</span> <span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>ConcretePiece</span> <span class=k>const</span> <span class=o>&amp;</span><span class=n>self</span><span class=p>()</span> <span class=k>const</span> <span class=p>{</span> <span class=k>return</span> <span class=o>*</span><span class=k>static_cast</span><span class=o>&lt;</span><span class=n>ConcretePiece</span> <span class=k>const</span> <span class=o>*&gt;</span><span class=p>(</span><span class=k>this</span><span class=p>);</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Validates basic moves
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>bool</span> <span class=nf>IsValidBasicMove</span><span class=p>(...)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>self</span><span class=p>().</span><span class=n>IsValidBasicMove_</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=k>protected</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>friend</span> <span class=n>ConcretePiece</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>BasePiece</span><span class=p>(...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=derived-piece-classes>Derived Piece Classes</h4><p>Each type of piece implements its specific characteristics:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Bishop</span> <span class=o>:</span> <span class=k>public</span> <span class=n>BasePiece</span><span class=o>&lt;</span><span class=n>Bishop</span><span class=o>&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=n>Bishop</span><span class=p>(...)</span> <span class=o>:</span> <span class=n>BasePiece</span><span class=p>(...)</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=k>friend</span> <span class=k>class</span> <span class=nc>BasePiece</span><span class=o>&lt;</span><span class=n>Bishop</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=nf>IsValidBasicMove_</span><span class=p>(...)</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=piece-variants>Piece Variants</h4><p>Pieces are represented using std::variant:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>using</span> <span class=n>Piece</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>variant</span><span class=o>&lt;</span><span class=n>EmptyPiece</span><span class=p>,</span> <span class=n>Bishop</span><span class=p>,</span> <span class=n>King</span><span class=p>,</span> <span class=n>Knight</span><span class=p>,</span> <span class=n>Pawn</span><span class=p>,</span> <span class=n>Queen</span><span class=p>,</span> <span class=n>Rook</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Pieces</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>Piece</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>PiecesReference</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>vector</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>reference_wrapper</span><span class=o>&lt;</span><span class=k>const</span> <span class=n>Piece</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=square-class>Square Class</h4><p>The Square class processes moves and manages the state of the pieces:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>class</span> <span class=nc>Square</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>public</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>PiecesReference</span> <span class=n>GetPieceOfTypeAndColor</span><span class=p>(</span><span class=k>const</span> <span class=n>PieceType</span> <span class=o>&amp;</span><span class=n>pieceType</span><span class=p>,</span> <span class=k>const</span> <span class=n>Color</span> <span class=o>&amp;</span><span class=n>color</span><span class=p>,</span> <span class=p>...)</span> <span class=k>const</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>PiecesReference</span> <span class=n>subPieces</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>...</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>subPieces</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Process BasicMove
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=nf>ProcessBasicMove</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=n>Pieces</span> <span class=n>pieces_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>Rounds</span> <span class=n>rounds_</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>private</span><span class=o>:</span>
</span></span><span class=line><span class=cl>    <span class=c1>// A move is valid if King won&#39;t be checked
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>void</span> <span class=n>ValidateMove</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=nf>VerifyIfKingBeingCheck</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Square</span><span class=o>::</span><span class=n>ProcessBasicMove</span><span class=p>(...)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Get pieces of a specific type (Pawn) and color (White)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>const</span> <span class=n>PiecesReference</span> <span class=o>&amp;</span><span class=n>subPieces</span> <span class=o>=</span> <span class=n>GetPieceOfTypeAndColor</span><span class=p>(</span><span class=n>PieceType</span><span class=o>::</span><span class=n>Pawn</span><span class=p>,</span> <span class=n>Color</span><span class=o>::</span><span class=n>White</span><span class=p>,</span> <span class=p>...);</span>
</span></span><span class=line><span class=cl>    <span class=kt>bool</span> <span class=n>isValid</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Iterate through the pieces to check if any can perform a valid basic move
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=k>auto</span> <span class=o>&amp;</span><span class=nl>it</span> <span class=p>:</span> <span class=n>subPieces</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>visit</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=o>&amp;</span><span class=p>](</span><span class=k>auto</span> <span class=o>&amp;&amp;</span><span class=n>piece</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>isValid</span> <span class=o>=</span> <span class=n>piece</span><span class=p>.</span><span class=n>IsValidBasicMove</span><span class=p>();</span>
</span></span><span class=line><span class=cl>                <span class=n>ValidateMove</span><span class=p>(...);</span>
</span></span><span class=line><span class=cl>            <span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=n>it</span><span class=p>.</span><span class=n>get</span><span class=p>());</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>isValid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>...</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><p>Explanation of <code>std::visit</code> and <code>std::variant</code> for Polymorphism:</p><ul><li><p>std::visit is used to handle the different possible types of pieces in a polymorphic manner:</p><ul><li><code>std::visit</code> is a utility function in C++17 that allows you to apply a callable (like a lambda function) to the value contained within a <code>std::variant</code>. This is particularly useful for handling different types that might be stored in the variant, providing a form of polymorphism.</li><li><code>'subPieces'</code> is a collection of <code>std::variant</code>, which can hold different types of pieces. This design allows for storing multiple types in a single collection while retaining type safety.</li><li>By using <code>std::visit</code>, we can invoke methods on the pieces contained in the variant without needing to know the specific type of each piece at compile time. The lambda function inside <code>std::visit</code> will be called with the actual type held by the variant.</li></ul></li><li><p>Using <code>std::visit</code> in conjunction with <code>std::variant</code> allows you to achieve polymorphic behavior without traditional inheritance, enabling you to handle multiple piece types in a type-safe manner.</p></li></ul></li></ul><h3 id=3-pros-and-cons>3. Pros and Cons</h3><h4 id=pros>Pros:</h4><ul><li>Type Safety: Ensures type-safe operations within variant.</li><li>Polymorphic Behavior: Enables runtime polymorphism without vtables.</li><li>Efficiency: Eliminates overhead from virtual function calls and pointer indirection typically associated with traditional inheritance models.</li><li>Flexibility: Supports adding new types without interface changes.</li></ul><h4 id=cons>Cons:</h4><ul><li>Compile-Time Knowledge: Requires knowing all variant types at compile time.</li><li>Error Handling Complexity: Handling unexpected types can be complex.</li><li>Debugging Complexity: Debugging interactions between variants and lambda functions can be intricate.</li><li>Memory Usage: Variants may consume more memory if objects stored have significantly different sizes, leading to potential memory fragmentation and inefficiency.</li></ul><h3 id=4-improvement>4. Improvement</h3><ul><li>Add Iterative mode</li><li>Support Forward-Backward interaction</li><li>Overload piece swap</li></ul><p>For more insights, refer to the following resources:</p><ul><li><a class=link href="https://youtu.be/xpomlTd41hg?si=1R4RAHh1p1Effef5" target=_blank rel=noopener>A Journey Into Non-Virtual Polymorphism in C++ - Rudyard Merriam - CppCon 2023</a></li><li><a class=link href=https://gist.github.com/olibre/3d0774df0f7a16e2da10fae2b2f26c4f target=_blank rel=noopener>C++ : Polymorphic inheritance without vtable</a></li></ul></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//https-www-nktho-fr.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 OH! THO</section><section class=powerby><br></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>